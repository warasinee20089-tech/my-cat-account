import streamlit as st
import pandas as pd
import os
import datetime
import matplotlib.pyplot as plt

# ---------------------------------------------------------
# 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á Streamlit)
# ---------------------------------------------------------
st.set_page_config(page_title="‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ß", page_icon="üê±", layout="wide")

# ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
DATA_FILE = "transactions.csv"

# ---------------------------------------------------------
# 2. ‡∏£‡∏∞‡∏ö‡∏ö Login ‡πÅ‡∏•‡∏∞ Session
# ---------------------------------------------------------
if 'logged_in' not in st.session_state:
    st.session_state['logged_in'] = False

def login():
    # --- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ---
    if st.session_state.username == "admin" and st.session_state.password == "1234":
        st.session_state['logged_in'] = True
    else:
        st.error("‚ùå ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á")

def logout():
    st.session_state['logged_in'] = False
    st.rerun()

# ---------------------------------------------------------
# 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (CSV)
# ---------------------------------------------------------
def load_data():
    if os.path.exists(DATA_FILE):
        try:
            return pd.read_csv(DATA_FILE)
        except:
            return pd.DataFrame(columns=["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà", "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô", "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"])
    else:
        return pd.DataFrame(columns=["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà", "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô", "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"])

def save_record(date, category, tx_type, amount, note):
    df = load_data()
    new_data = pd.DataFrame([{
        "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà": date,
        "‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà": category,
        "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó": tx_type,
        "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô": float(amount),
        "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏": note
    }])
    # ‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
    df = pd.concat([df, new_data], ignore_index=True)
    df.to_csv(DATA_FILE, index=False)

# ---------------------------------------------------------
# 4. ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏Å (Main App)
# ---------------------------------------------------------

# ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Login
if not st.session_state['logged_in']:
    # === ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Login ===
    st.title("üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö")
    st.write("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢")
    
    col1, col2 = st.columns([1, 2])
    with col1:
        st.text_input("Username", key="username")
        st.text_input("Password", type="password", key="password")
        st.button("Login", on_click=login)

else:
    # === ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ===
    
    # Sidebar (‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    with st.sidebar:
        st.header(f"üê± ‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£")
        st.write("‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô!")
        if st.button("üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö", use_container_width=True):
            logout()

    st.title("üê± ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ß (Full Option)")
    
    # ‡∏™‡∏£‡πâ‡∏≤‡∏á Tabs 3 ‡∏´‡∏ô‡πâ‡∏≤
    tab1, tab2, tab3 = st.tabs(["üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£", "üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£", "üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î/‡∏Å‡∏£‡∏≤‡∏ü"])

    # --- TAB 1: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ---
    with tab1:
        st.subheader("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà")
        
        # 1. ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
        c1, c2 = st.columns(2)
        with c1:
            tx_date = st.date_input("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", value=datetime.date.today())
        with c2:
            tx_type = st.radio("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:", ["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ üí∏", "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö üí∞", "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏° üê∑"], horizontal=True)

        st.divider()

        # 2. ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á)
        input_method = st.radio("‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:", ["‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£", "‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á"], horizontal=True)
        
        category = ""
        if input_method == "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£":
            # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            if tx_type == "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏° üê∑":
                opts = ["‡∏´‡∏¢‡∏≠‡∏î‡∏Å‡∏£‡∏∞‡∏õ‡∏∏‡∏Å", "‡∏ù‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£", "‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô/‡∏´‡∏∏‡πâ‡∏ô", "‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥", "‡∏™‡∏•‡∏≤‡∏Å‡∏≠‡∏≠‡∏°‡∏™‡∏¥‡∏ô", "‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô"]
            elif tx_type == "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö üí∞":
                opts = ["‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", "‡πÇ‡∏ö‡∏ô‡∏±‡∏™", "‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå", "‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô", "‡∏ñ‡∏π‡∏Å‡∏´‡∏ß‡∏¢", "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]
            else:
                opts = ["‡∏≠‡∏≤‡∏´‡∏≤‡∏£", "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°", "‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á", "‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß", "‡∏Ñ‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á/‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î", "‡∏ô‡πâ‡∏≥/‡πÑ‡∏ü/‡πÄ‡∏ô‡πá‡∏ï", "‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á", "‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•", "‡πÉ‡∏´‡πâ‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà", "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"]
            
            category = st.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î:", opts)
        else:
            category = st.text_input("‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏≠‡∏á:", placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏°‡∏ß, ‡∏ã‡πà‡∏≠‡∏°‡∏£‡∏ñ, ‡πÉ‡∏™‡πà‡∏ã‡∏≠‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏á")

        # 3. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
        c3, c4 = st.columns(2)
        with c3:
            amount = st.number_input("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó):", min_value=0.0, format="%.2f")
        with c4:
            note = st.text_input("‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:", placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏±‡∏ô‡∏•‡∏∑‡∏°...")

        # 4. ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        if st.button("‚ù§Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£", use_container_width=True):
            if not category:
                st.error("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà")
            elif amount <= 0:
                st.warning("‚ö†Ô∏è ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0")
            else:
                save_record(tx_date, category, tx_type, amount, note)
                st.success(f"‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: **{category}** ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{amount}** ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!")
                st.rerun()

    # --- TAB 2: ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ---
    with tab2:
        st.subheader("‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")
        df = load_data()
        
        if not df.empty:
            # ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô)
            st.dataframe(df.sort_index(ascending=False), use_container_width=True)
            
            # ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            st.write("---")
            with st.expander("üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Zone ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢)"):
                st.warning("‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢‡∏´‡∏°‡∏î ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö")
                if st.button("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"):
                    if os.path.exists(DATA_FILE):
                        os.remove(DATA_FILE)
                        st.success("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß")
                        st.rerun()
        else:
            st.info("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")

    # --- TAB 3: ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü ---
    with tab3:
        st.subheader("üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô")
        df = load_data()
        
        if not df.empty:
            # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°
            inc = df[df["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"]=="‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö üí∞"]["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"].sum()
            exp = df[df["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"]=="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ üí∏"]["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"].sum()
            sav = df[df["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"]=="‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏° üê∑"]["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"].sum()
            balance = inc - exp - sav # ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏´‡∏±‡∏Å‡∏≠‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß)

            # ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
            col_a, col_b, col_c, col_d = st.columns(4)
            col_a.metric("‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö", f"{inc:,.2f}", delta="‡∏ö‡∏≤‡∏ó")
            col_b.metric("‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢", f"{exp:,.2f}", delta="-‡∏ö‡∏≤‡∏ó", delta_color="inverse")
            col_c.metric("‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°", f"{sav:,.2f}", delta="‡∏™‡∏∞‡∏™‡∏°")
            col_d.metric("‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á", f"{balance:,.2f}")

            st.divider()

            # ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°
            c_chart1, c_chart2 = st.columns(2)
            
            with c_chart1:
                st.write("**üí∞ ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô (‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°)**")
                sum_type = df.groupby("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó")["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"].sum()
                if not sum_type.empty:
                    fig, ax = plt.subplots()
                    # ‡πÉ‡∏ä‡πâ autopct ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á %
                    ax.pie(sum_type, labels=sum_type.index, autopct='%1.1f%%', startangle=90, colors=['#ff9999','#66b3ff','#99ff99'])
                    ax.axis('equal')
                    st.pyplot(fig)

            with c_chart2:
                st.write("**üí∏ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡∏´‡∏°‡∏î‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£?)**")
                exp_df = df[df["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"]=="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ üí∏"]
                if not exp_df.empty:
                    sum_exp = exp_df.groupby("‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà")["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"].sum()
                    fig2, ax2 = plt.subplots()
                    ax2.pie(sum_exp, labels=sum_exp.index, autopct='%1.1f%%', startangle=90)
                    ax2.axis('equal')
                    st.pyplot(fig2)
                else:
                    st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢")
            
            # ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°
            st.write("---")
            st.write("**üê∑ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°**")
            sav_df = df[df["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"]=="‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏° üê∑"]
            if not sav_df.empty:
                sum_sav = sav_df.groupby("‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà")["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"].sum()
                fig3, ax3 = plt.subplots(figsize=(6, 3)) # ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü
                ax3.barh(sum_sav.index, sum_sav.values, color='gold')
                st.pyplot(fig3)
            else:
                st.info("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏° ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≠‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢!")

        else:
            st.info("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü")
